# æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬çš„æ›´çº±é»‘ä½“
name: Create tag if there's a new Sarasa Gothic version

on:
  # æ¯12å°æ—¶
  schedule:
    - cron: "0 */12 * * *"
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  build:
    if: github.repository == 'lichongjia/JetBrains-Sarasa-Mono'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Magic ðŸ˜Ž
        run: |
          # æŸ¥æ‰¾æœ€æ–°ç‰ˆæœ¬å·
          LATEST_TAG=`curl --silent "https://api.github.com/repos/be5invis/Sarasa-Gothic/releases/latest" | jq -r .tag_name`
          echo "Latest tag of be5invis/Sarasa-Gothic is ${LATEST_TAG}"

          # æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨åŒ¹é…çš„ç‰ˆæœ¬å·
          if git rev-parse "$LATEST_TAG" >/dev/null 2>&1; then
            echo "${LATEST_TAG} tag exists, do nothing.";
          else
            echo "${LATEST_TAG} tag does not exist, tag it to trigger next action."
            git config user.name github-actions
            git config user.email github-actions@github.com
            git tag -a ${LATEST_TAG} -m "ðŸŽ‰ build: release version ${LATEST_TAG}"
            git push origin --tags
          fi
